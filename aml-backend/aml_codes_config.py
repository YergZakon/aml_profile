# Конфигурационный файл с кодами для системы AML АФМ РК
# aml_codes_config.py

"""
Централизованное хранилище всех кодов и справочников
для системы мониторинга транзакций АФМ РК

ВАЖНО: Все числовые коды стран без ведущих нулей!
"""

# =====================================================
# КОДЫ СТРАН (ISO 3166-1 numeric -> alpha-2)
# =====================================================

COUNTRY_CODES = {
    # СНГ и соседние страны
    398: 'KZ',  # Казахстан
    643: 'RU',  # Россия
    156: 'CN',  # Китай
    417: 'KG',  # Кыргызстан
    860: 'UZ',  # Узбекистан
    795: 'TM',  # Туркменистан
    762: 'TJ',  # Таджикистан
    31: 'AZ',   # Азербайджан (031)
    51: 'AM',   # Армения (051)
    112: 'BY',  # Беларусь
    268: 'GE',  # Грузия
    498: 'MD',  # Молдова
    804: 'UA',  # Украина
    
    # Основные торговые партнеры
    840: 'US',  # США
    826: 'GB',  # Великобритания
    276: 'DE',  # Германия
    250: 'FR',  # Франция
    380: 'IT',  # Италия
    724: 'ES',  # Испания
    528: 'NL',  # Нидерланды
    756: 'CH',  # Швейцария
    40: 'AT',   # Австрия (040)
    56: 'BE',   # Бельгия (056)
    203: 'CZ',  # Чехия
    616: 'PL',  # Польша
    792: 'TR',  # Турция
    364: 'IR',  # Иран
    784: 'AE',  # ОАЭ
    682: 'SA',  # Саудовская Аравия
    376: 'IL',  # Израиль
    400: 'JO',  # Иордания
    422: 'LB',  # Ливан
    
    # Азиатско-Тихоокеанский регион
    392: 'JP',  # Япония
    410: 'KR',  # Южная Корея
    702: 'SG',  # Сингапур
    458: 'MY',  # Малайзия
    764: 'TH',  # Таиланд
    704: 'VN',  # Вьетнам
    356: 'IN',  # Индия
    586: 'PK',  # Пакистан
    50: 'BD',   # Бангладеш (050)
    144: 'LK',  # Шри-Ланка
    
    # Офшорные юрисдикции
    136: 'KY',  # Каймановы острова
    92: 'VG',   # Британские Виргинские острова (092)
    44: 'BS',   # Багамы (044)
    84: 'BZ',   # Белиз (084)
    690: 'SC',  # Сейшельские острова
    548: 'VU',  # Вануату
    430: 'LR',  # Либерия
    584: 'MH',  # Маршалловы острова
    480: 'MU',  # Маврикий
    60: 'BM',   # Бермуды (060)
    831: 'GG',  # Гернси
    832: 'JE',  # Джерси
    833: 'IM',  # Остров Мэн
    292: 'GI',  # Гибралтар
    20: 'AD',   # Андорра (020)
    438: 'LI',  # Лихтенштейн
    492: 'MC',  # Монако
    
    # Страны высокого риска (FATF)
    408: 'KP',  # Северная Корея
    760: 'SY',  # Сирия
    4: 'AF',    # Афганистан (004)
    887: 'YE',  # Йемен
    104: 'MM',  # Мьянма
    
    # Другие важные страны
    124: 'CA',  # Канада
    36: 'AU',   # Австралия (036)
    554: 'NZ',  # Новая Зеландия
    76: 'BR',   # Бразилия (076)
    484: 'MX',  # Мексика
    32: 'AR',   # Аргентина (032)
    152: 'CL',  # Чили
    710: 'ZA',  # ЮАР
    818: 'EG',  # Египет
    566: 'NG',  # Нигерия
    404: 'KE',  # Кения
}

# Страны высокого риска (FATF черный и серый списки)
HIGH_RISK_COUNTRIES = {
    # Черный список FATF
    408: 'KP',  # Северная Корея
    364: 'IR',  # Иран
    
    # Серый список FATF (по состоянию на 2024)
    4: 'AF',    # Афганистан (004)
    8: 'AL',    # Албания (008)
    52: 'BB',   # Барбадос (052)
    854: 'BF',  # Буркина-Фасо
    116: 'KH',  # Камбоджа
    136: 'KY',  # Каймановы острова
    180: 'CD',  # ДР Конго
    292: 'GI',  # Гибралтар
    332: 'HT',  # Гаити
    388: 'JM',  # Ямайка
    400: 'JO',  # Иордания
    466: 'ML',  # Мали
    508: 'MZ',  # Мозамбик
    104: 'MM',  # Мьянма
    558: 'NI',  # Никарагуа
    586: 'PK',  # Пакистан
    591: 'PA',  # Панама
    608: 'PH',  # Филиппины
    686: 'SN',  # Сенегал
    728: 'SS',  # Южный Судан
    760: 'SY',  # Сирия
    834: 'TZ',  # Танзания
    792: 'TR',  # Турция
    800: 'UG',  # Уганда
    784: 'AE',  # ОАЭ
    887: 'YE',  # Йемен
    716: 'ZW',  # Зимбабве
}

# Офшорные юрисдикции
OFFSHORE_COUNTRIES = {
    136: 'KY',  # Каймановы острова
    92: 'VG',   # Британские Виргинские острова (092)
    44: 'BS',   # Багамы (044)
    84: 'BZ',   # Белиз (084)
    690: 'SC',  # Сейшельские острова
    548: 'VU',  # Вануату
    430: 'LR',  # Либерия
    584: 'MH',  # Маршалловы острова
    480: 'MU',  # Маврикий
    60: 'BM',   # Бермуды (060)
    831: 'GG',  # Гернси
    832: 'JE',  # Джерси
    833: 'IM',  # Остров Мэн
    292: 'GI',  # Гибралтар
    20: 'AD',   # Андорра (020)
    438: 'LI',  # Лихтенштейн
    492: 'MC',  # Монако
}

# =====================================================
# КОДЫ ПОДОЗРИТЕЛЬНЫХ ОПЕРАЦИЙ АФМ РК
# =====================================================

# Основные признаки подозрительности
SUSPICION_CODES_MAIN = {
    1035: 'Нетипичное поведение клиента',
    1036: 'Запутанный или необычно сложный характер сделки',
    1037: 'Отсутствие очевидной экономической целесообразности',
    1038: 'Несоответствие сделки целям деятельности',
    1039: 'Неоднократное совершение операций с признаками ОД/ФТ',
    1040: 'Отказ от совершения разовой операции при информировании о мерах ПОД/ФТ',
    1041: 'Операция с участием юрисдикции высокого риска',
    1042: 'Операция с участием лица из перечня ФТ',
    1043: 'Замораживание операции по решению уполномоченного органа',
}

# Схемы отмывания
SUSPICION_CODES_SCHEMES = {
    1054: 'Дробление крупной суммы на мелкие (структурирование)',
    1055: 'Транзитные операции',
    1056: 'Обналичивание денежных средств',
    1057: 'Использование подставных лиц',
    1058: 'Фиктивные сделки',
    1059: 'Завышение/занижение стоимости товаров и услуг',
    1060: 'Сделки с недвижимостью по нерыночным ценам',
    1061: 'Операции с ценными бумагами с признаками манипулирования',
    1062: 'Признаки финансовой пирамиды',
    1063: 'Операции без явной связи с деятельностью клиента',
}

# Платежи и переводы
SUSPICION_CODES_PAYMENTS = {
    1064: 'Перевод на счет в офшорной зоне',
    1065: 'Поступление из офшорной зоны',
    1066: 'Многочисленные переводы в пользу третьих лиц',
    1067: 'Регулярные платежи физлицам от юрлиц',
    1068: 'Снятие наличных в день поступления',
    1069: 'Круглые суммы операций',
    1070: 'Операции в нерабочее время',
}

# Наличные операции
SUSPICION_CODES_CASH = {
    1071: 'Внесение наличных структурированными суммами',
    1072: 'Снятие наличных крупными суммами',
    1073: 'Покупка/продажа наличной валюты в больших объемах',
    1074: 'Использование банкоматов для структурирования',
}

# Криптовалюты и виртуальные активы
SUSPICION_CODES_CRYPTO = {
    8001: 'Обмен криптовалюты на фиат',
    8002: 'Операции с криптовалютами',
    8003: 'Майнинг криптовалют',
    8004: 'ICO и токены',
    8005: 'DeFi операции',
    8006: 'NFT транзакции',
}

# Все коды подозрительности в одном словаре
ALL_SUSPICION_CODES = {
    **SUSPICION_CODES_MAIN,
    **SUSPICION_CODES_SCHEMES,
    **SUSPICION_CODES_PAYMENTS,
    **SUSPICION_CODES_CASH,
    **SUSPICION_CODES_CRYPTO,
    
    # Дополнительные коды
    1091: 'Иные подозрительные операции',
    1092: 'Подозрительная операция - общий код',
    
    # Пороговые операции
    2001: 'Операция с наличными свыше порога',
    2002: 'Перевод денег свыше порога',
    2003: 'Обмен валюты свыше порога',
    
    # Финансирование терроризма
    5001: 'Подозрение в финансировании терроризма',
    5002: 'Операция с лицом из перечня ФТ',
    
    # Санкции
    6001: 'Операция с лицом под санкциями',
    6002: 'Обход санкционных ограничений',
}

# =====================================================
# ПОРОГОВЫЕ ЗНАЧЕНИЯ АФМ РК (в тенге)
# =====================================================

THRESHOLDS = {
    'cash_operation': 2_000_000,      # Наличные операции
    'money_transfer': 7_000_000,      # Денежные переводы
    'international': 1_000_000,       # Международные операции
    'real_estate': 40_000_000,        # Операции с недвижимостью
    'securities': 10_000_000,         # Операции с ценными бумагами
    'currency_exchange': 5_000_000,   # Обмен валюты
    'precious_metals': 15_000_000,    # Операции с драгметаллами
}

# =====================================================
# ТИПЫ ОПЕРАЦИЙ
# =====================================================

OPERATION_TYPES = {
    '1100': 'Внесение наличных',
    '1200': 'Снятие наличных',
    '2100': 'Перевод внутри банка',
    '2200': 'Перевод в другой банк',
    '2300': 'Международный перевод',
    '3100': 'Обмен валюты',
    '4100': 'Оплата картой',
    '5100': 'Выдача кредита',
    '5200': 'Погашение кредита',
}

# =====================================================
# ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
# =====================================================

def get_country_name(numeric_code: int) -> str:
    """Получить название страны по числовому коду"""
    # Проверяем все словари
    alpha2 = None
    
    # Проверяем основной словарь
    if numeric_code in COUNTRY_CODES:
        alpha2 = COUNTRY_CODES[numeric_code]
    # Проверяем высокорисковые страны
    elif numeric_code in HIGH_RISK_COUNTRIES:
        alpha2 = HIGH_RISK_COUNTRIES[numeric_code]
    # Проверяем офшоры
    elif numeric_code in OFFSHORE_COUNTRIES:
        alpha2 = OFFSHORE_COUNTRIES[numeric_code]
    else:
        alpha2 = 'XX'
    
    # Словарь названий стран
    country_names = {
        'KZ': 'Казахстан',
        'RU': 'Россия',
        'CN': 'Китай',
        'US': 'США',
        'GB': 'Великобритания',
        'DE': 'Германия',
        'AE': 'ОАЭ',
        'TR': 'Турция',
        'KG': 'Кыргызстан',
        'UZ': 'Узбекистан',
        'IR': 'Иран',
        'KP': 'Северная Корея',
        'KY': 'Каймановы острова',
        'VG': 'Британские Виргинские острова',
        'XX': 'Неизвестная страна'
    }
    
    return country_names.get(alpha2, f'Страна {alpha2}')

def get_risk_level(country_code: str) -> str:
    """Определить уровень риска страны"""
    # Проверяем по спискам
    if country_code in ['KP', 'IR']:  # Черный список FATF
        return 'PROHIBITED'
    elif country_code in HIGH_RISK_COUNTRIES.values():
        return 'HIGH'
    elif country_code in OFFSHORE_COUNTRIES.values():
        return 'OFFSHORE'
    elif country_code == 'KZ':
        return 'LOW'
    else:
        return 'MEDIUM'

def get_suspicion_category(code: int) -> str:
    """Определить категорию кода подозрительности"""
    if code in SUSPICION_CODES_MAIN:
        return 'Основные признаки'
    elif code in SUSPICION_CODES_SCHEMES:
        return 'Схемы отмывания'
    elif code in SUSPICION_CODES_PAYMENTS:
        return 'Платежи и переводы'
    elif code in SUSPICION_CODES_CASH:
        return 'Наличные операции'
    elif code in SUSPICION_CODES_CRYPTO:
        return 'Криптовалюты'
    elif 2000 <= code < 3000:
        return 'Пороговые операции'
    elif 5000 <= code < 6000:
        return 'Финансирование терроризма'
    else:
        return 'Прочие'

# =====================================================
# ЭКСПОРТ В JSON (для других систем)
# =====================================================

def export_to_json(filename: str = 'aml_codes.json'):
    """Экспорт всех кодов в JSON файл"""
    import json
    
    data = {
        'country_codes': COUNTRY_CODES,
        'high_risk_countries': HIGH_RISK_COUNTRIES,
        'offshore_countries': OFFSHORE_COUNTRIES,
        'suspicion_codes': ALL_SUSPICION_CODES,
        'thresholds': THRESHOLDS,
        'operation_types': OPERATION_TYPES
    }
    
    with open(filename, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print(f"✅ Коды экспортированы в {filename}")

if __name__ == "__main__":
    # Примеры использования
    print("📊 СТАТИСТИКА КОДОВ:")
    print(f"├── Стран всего: {len(COUNTRY_CODES) + len(HIGH_RISK_COUNTRIES) + len(OFFSHORE_COUNTRIES)}")
    print(f"├── Высокорисковых стран: {len(HIGH_RISK_COUNTRIES)}")
    print(f"├── Офшорных юрисдикций: {len(OFFSHORE_COUNTRIES)}")
    print(f"└── Кодов подозрительности: {len(ALL_SUSPICION_CODES)}")
    
    # Пример проверки страны
    print("\n🌍 ПРОВЕРКА СТРАНЫ:")
    test_country = 136  # Каймановы острова
    print(f"Код {test_country} = {get_country_name(test_country)}")
    print(f"Уровень риска: {get_risk_level('KY')}")
    
    # Пример проверки кода подозрительности
    print("\n🔍 ПРОВЕРКА КОДА ПОДОЗРИТЕЛЬНОСТИ:")
    test_code = 1054
    print(f"Код {test_code}: {ALL_SUSPICION_CODES.get(test_code)}")
    print(f"Категория: {get_suspicion_category(test_code)}")
